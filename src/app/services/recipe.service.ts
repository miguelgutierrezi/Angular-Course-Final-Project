import {Injectable} from '@angular/core';
import {Recipe} from '../models/recipe';
import {Ingredient} from '../models/ingredient';
import {ShoppingListService} from './shopping-list.service';
import {Subject} from 'rxjs';
import {HttpClient} from '@angular/common/http';
import {environment} from '../../environments/environment';
import {map, tap} from 'rxjs/operators';
import {Store} from '@ngrx/store';
import * as Actions from '../components/shopping-list/store/shopping-list.actions';
import * as fromApp from '../store/app.reducer';


@Injectable({
  providedIn: 'root'
})
export class RecipeService {
  private readonly FIREBASEDB = environment.firebaseEndpoint;
  recipesChanges = new Subject<Recipe[]>();
  private recipes: Array<Recipe> = [
    /* new Recipe(
      'Arroz con pollo',
      'Colombian typical food',
      'https://s1.eestatic.com/2020/01/28/cocinillas/recetas/pasta-y-arroz/Arroz-Pollo-Pasta_y_arroz_463216136_143694760_1706x960.jpg',
      [
        new Ingredient('Chicken', 1),
        new Ingredient('Rise', 20)
      ]
    ),
    new Recipe(
      'Ajiaco',
      'Colombian typical food',
      'data:image/jpeg;base64,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',
      [
        new Ingredient('Chicken', 2),
        new Ingredient('Potatoes', 2)
      ]
    ) */
  ];

  constructor(
    private shoppingListService: ShoppingListService,
    private http: HttpClient,
    private store: Store<fromApp.AppState>
  ) {
  }

  getRecipes(): Array<Recipe> {
    return this.recipes.slice();
  }

  getRecipe(id: number): Recipe {
    return this.recipes[id];
  }

  addIngredients(ingredients: Ingredient[]) {
    // this.shoppingListService.addIngredients(ingredients);
    this.store.dispatch(new Actions.AddIngredients(ingredients));
  }

  addRecipe(newRecipe: Recipe) {
    this.recipes.push(newRecipe);
    this.recipesChanges.next(this.recipes.slice());
  }

  updateRecipe(id: number, newRecipe: Recipe) {
    this.recipes[id] = newRecipe;
    this.recipesChanges.next(this.recipes.slice());
  }

  deleteRecipe(id: number) {
    this.recipes.splice(id, 1);
    this.recipesChanges.next(this.recipes.slice());
  }

  storeRecipesDb() {
    const recipes = this.recipes;
    return this.http.put(this.FIREBASEDB + 'recipes.json', recipes)
      .subscribe(res => {
        console.log(res);
      });
  }

  fetchRecipes() {
    return this.http.get<Recipe[]>(this.FIREBASEDB + 'recipes.json')
      .pipe(map(recipes => {
          return recipes.map(recipe => {
            return {...recipe, ingredients: recipe.ingredients ? recipe.ingredients : []};
          });
        }),
        tap(recipes => {
          this.recipes = recipes;
          this.recipesChanges.next(this.recipes.slice());
        })
      );
  }
}
